--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Consultas  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--1. Mostrar todos los pedidos de un negocio
SELECT  PEDIDO_ID AS NO_PEDIDO,PEDIDO_FECHA_CREACION AS FECHA,NEGOCIO_NOMBRE AS NEGOCIO,PEDIDO_ESTATUS AS ESTATUS
FROM PEDIDO
JOIN DETALLE_PEDIDO ON DP_PEDIDO_ID = PEDIDO_ID
JOIN PLATILLO ON DP_PLATILLO_ID = PLATILLO_ID
JOIN NEGOCIO ON PLATILLO_NEGOCIO_ID = NEGOCIO_ID 
WHERE UPPER(NEGOCIO_NOMBRE) LIKE UPPER('COCINA ECONOMICA');

--2. Mostrar todos los pedidos entregados por un repartidor
SELECT PEDIDO_ID AS NO_PEDIDO,PEDIDO_FECHA_CREACION AS FECHA,REPARTIDOR_NOMBRE, REPARTIDOR_APELLIDOP, REPARTIDOR_APELLIDOM,PEDIDO_ESTATUS AS ESTATUS
FROM PEDIDO
JOIN REPARTIDOR ON PEDIDO_REPARTIDOR_ID = REPARTIDOR_ID
JOIN DETALLE_PEDIDO ON DP_PEDIDO_ID = PEDIDO_ID
JOIN PLATILLO ON DP_PLATILLO_ID = PLATILLO_ID
WHERE UPPER(REPARTIDOR_NOMBRE) LIKE UPPER('DANIEL') AND UPPER(REPARTIDOR_APELLIDOP) LIKE UPPER('ROSAS') AND UPPER(REPARTIDOR_APELLIDOM) LIKE UPPER('DIAZ');

--3. ¿Cuál es el negocio que vende más?
SELECT NEGOCIO_NOMBRE AS NEGOCIO,SUM(((PLATILLO_COSTO*DP_CANTIDAD_PLATILLO))+PEDIDO_COSTO_ENVIO)AS COSTO_TOTAL_PEDIDOS,SUM((((PLATILLO_COSTO*DP_CANTIDAD_PLATILLO))+PEDIDO_COSTO_ENVIO)*.20) AS GANANCIA_REPARTIDORES,SUM((((PLATILLO_COSTO*DP_CANTIDAD_PLATILLO))+PEDIDO_COSTO_ENVIO)-((((PLATILLO_COSTO*DP_CANTIDAD_PLATILLO))+PEDIDO_COSTO_ENVIO)*.20)) AS GANANCIA_NEGOCIO
FROM NEGOCIO 
JOIN PLATILLO ON PLATILLO_NEGOCIO_ID = NEGOCIO_ID
JOIN DETALLE_PEDIDO ON DP_PLATILLO_ID = PLATILLO_ID
JOIN PEDIDO ON DP_PEDIDO_ID = PEDIDO_ID
GROUP BY NEGOCIO_NOMBRE
ORDER BY GANANCIA_NEGOCIO DESC;

--4. ¿Cuál es el repartidor con más entregas?
SELECT REPARTIDOR_NOMBRE, REPARTIDOR_APELLIDOP,REPARTIDOR_APELLIDOM, COUNT(PEDIDO_ID) AS NO_ENTREGAS
FROM REPARTIDOR 
JOIN PEDIDO ON PEDIDO_REPARTIDOR_ID = REPARTIDOR_ID
GROUP BY REPARTIDOR_NOMBRE, REPARTIDOR_APELLIDOP,REPARTIDOR_APELLIDOM
ORDER BY NO_ENTREGAS DESC;

--5. Mostrar la cantidad de pedidos por alcaldía
SELECT DIRECCION_MUNICIPIO_ALCALDIA AS MUN_ALC, COUNT(PEDIDO_ID) AS NO_PEDIDOS
FROM PEDIDO
JOIN CLIENTE ON PEDIDO_CLIENTE_ID = CLIENTE_ID
JOIN DIRECCION ON CLIENTE_DIRECCION_ID = DIRECCION_ID
GROUP BY DIRECCION_MUNICIPIO_ALCALDIA
ORDER BY NO_PEDIDOS DESC;